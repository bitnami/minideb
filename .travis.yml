language: bash
sudo: required
script: sudo bash buildall
dist: xenial
services:
  - docker
before_install:
  # Fix for Ubuntu Xenial apt-daily.service triggering
  # https://unix.stackexchange.com/questions/315502/how-to-disable-apt-daily-service-on-ubuntu-cloud-vm-image
  - |
    sudo systemctl stop apt-daily.service &&
    sudo systemctl kill --kill-who=all apt-daily.service &&
    while ! (systemctl list-units --all apt-daily.service | fgrep -q dead) ; do
      sleep 1
    done
  - sudo apt-get -qq update
  - sudo apt-get install -y debian-archive-keyring debootstrap
deploy:
  provider: script
  script: bash pushall
  skip_cleanup: true
  on:
    branch: master
